<!DOCTYPE html>
<html lang="en">
<title>Delivery of Service - D O S</title>
<link href='https://fonts.googleapis.com/css?family=Raleway:500' rel='stylesheet' type='text/css'>
<script src="/static/js/jquery-1.12.2.js"></script>
<link rel="stylesheet" href="/static/css/rating.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.css" type="text/css">
<script type="text/javascript" src='/static/bootstrap/js/bootstrap.js'></script>
<link rel="stylesheet" href="/static/css/styles.css" type="text/css">
<link rel="stylesheet" href="/static/css/navbar-fixed-top.css" type="text/css">
<script src="/static/js/jquery-ui.js"></script>
<script type="text/javascript">
	$( document ).ready(function() {
		$( "#tabs" ).tabs();
		$(document).on('click','li',function(){
			$(this).removeClass("active");
			$(this).siblings().removeClass("active");
			$(this).addClass("active");
		});
	});
</script>
</head>
<body>
	{% if session['id']: %}
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<img src="/static/img/DOS_icon.svg" alt="">
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				
				<ul class="nav navbar-nav navbar-right">
<!-- 						<li><a href="#">Vendors</a></li>
						<li><a href="#">Contractors</a></li>
						<li><a href="#">Search</a></li> -->
						<li><a href="/users/showall">Users</a></li> 
						<li><a href="/jobs/joblist">Jobs</a></li> 
						<li><a href="/users/show/{{ session['id'] }}">Profile</a></li>
						<li>{% if session['facebook'] %}
							<a href="/users/logout" onclick="FB.logout();"><button type="button" class="btn btn-sm" id="logoutbtn">Log Out</button></a>
							{% else %}<a href="/users/logout"><button type="button" class="btn btn-sm" id="logoutbtn">Log Out</button></a>
							{% endif %}</li>
						</ul>
					</div> 
				</div>
			</nav>
			{% else %}
			<nav class="navbar navbar-default navbar-fixed-top">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<img src="/static/img/DOS_icon.svg" alt="">
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						
						<ul class="nav navbar-nav navbar-right">
							<li><a href="#">About</a></li>
							<li><a href="#">Contact</a></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</nav>
			{% endif %}
			{% block content %}{% endblock %}
			<div class="row">
				{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
				{% for category, message in messages %}
				{%if message != ''%}
				<p>{{category}}: {{message}}</p>
				{%endif%}
				{% endfor %}
				{% endif %}
				{% endwith %}
			</div>
			{% if session['id'] %}
			<script>
				  // This is called with the results from from FB.getLoginStatus().
				  function statusChangeCallback(response) {
				  	console.log('statusChangeCallback');
				  	console.log(response);
				    // The response object is returned with a status field that lets the
				    // app know the current login status of the person.
				    // Full docs on the response object can be found in the documentation
				    // for FB.getLoginStatus().
				    if (response.status === 'connected') {
				      // Logged into your app and Facebook.
				      testAPI();
				  } else if (response.status === 'not_authorized') {
				      // The person is logged into Facebook, but not your app.
				      document.getElementById('status').innerHTML = 'Please log ' +
				      'into this app.';
				  } else {
				      // The person is not logged into Facebook, so we're not sure if
				      // they are logged into this app or not.
				      document.getElementById('status').innerHTML = 'Please log ' +
				      'into Facebook.';
				  }
				}

				  // This function is called when someone finishes with the Login
				  // Button.  See the onlogin handler attached to it in the sample
				  // code below.
				  function checkLoginState() {
				  	FB.getLoginStatus(function(response) {
				  		statusChangeCallback(response);
				  	});
				  }

				  window.fbAsyncInit = function() {
				  	FB.init({
				  		appId      : '629724553844886',
				    cookie     : true,  // enable cookies to allow the server to access 
				                        // the session
				    xfbml      : true,  // parse social plugins on this page
				    version    : 'v2.5' // use graph api version 2.5
				});

				  // Now that we've initialized the JavaScript SDK, we call 
				  // FB.getLoginStatus().  This function gets the state of the
				  // person visiting this page and can return one of three states to
				  // the callback you provide.  They can be:
				  //
				  // 1. Logged into your app ('connected')
				  // 2. Logged into Facebook, but not your app ('not_authorized')
				  // 3. Not logged into Facebook and can't tell if they are logged into
				  //    your app or not.
				  //
				  // These three cases are handled in the callback function.

				  FB.getLoginStatus(function(response) {
				  	statusChangeCallback(response);
				  });

				};

				  // Load the SDK asynchronously
				  (function(d, s, id) {
				  	var js, fjs = d.getElementsByTagName(s)[0];
				  	if (d.getElementById(id)) return;
				  	js = d.createElement(s); js.id = id;
				  	js.src = "//connect.facebook.net/en_US/sdk.js";
				  	fjs.parentNode.insertBefore(js, fjs);
				  }(document, 'script', 'facebook-jssdk'));

				  // Here we run a very simple test of the Graph API after login is
				  // successful.  See statusChangeCallback() for when this call is made.
				  function testAPI() {
				  	console.log('Welcome!  Fetching your information.... ');
				  	FB.api('/me?fields=email,first_name,last_name', function(response) {
				  		console.log('Successful login for: ' + response);
				  		document.getElementById('status').innerHTML =
				  		'Thanks for logging in, ' + response.email + '!';
				  		window.location = "/users/logout" 
				  	});
				  }
				</script>
				{% endif %}								
			</body>
			</html>
